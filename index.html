<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Music Braille Teacher</title>
<style>
:root{--p:#2c3e50;--s:#27ae60;--e:#e74c3c;--a:#e67e22;--b:#f4f7f6}body{font-family:system-ui,-apple-system,sans-serif;background:var(--b);margin:0;padding:0;color:#333;overflow-x:hidden}#welcome-screen{position:fixed;top:0;left:0;width:100%;height:100%;background:#1a2a3a;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#fff;z-index:2000}.welcome-content{text-align:center;padding:20px}.container{max-width:1100px;margin:auto;padding:20px;display:none}.tabs{display:flex;gap:8px;margin-bottom:25px;justify-content:center;flex-wrap:wrap}.tab-btn{padding:12px 22px;border:none;border-radius:25px;cursor:pointer;font-weight:700;background:#e0e0e0;transition:.3s;font-size:1rem}.tab-btn.active{background:var(--a);color:#fff;box-shadow:0 4px 12px rgba(230,126,34,.3)}.content-panel{display:none;background:#fff;padding:30px;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.08)}.content-panel.active{display:block}.staff-container{background:#fff;border:2px solid #eee;border-radius:15px;padding:20px;margin:20px 0}.braille-grid{display:grid;grid-template-columns:repeat(2,75px);gap:20px;justify-content:center;margin:25px 0}.dot{width:75px;height:75px;border-radius:50%;border:3px solid #eee;display:flex;align-items:center;justify-content:center;font-size:1.3rem;font-weight:700;color:#ddd;background:#fff;position:relative}.dot.active{background:var(--p);border-color:var(--p);color:#fff}.char-preview{font-size:5rem;color:var(--a);text-align:center;min-height:120px}.pdf-viewer{width:100%;height:600px;border:none;border-radius:10px;margin-top:20px}
/* Fix pulsante per VoiceOver */
.btn-accessibile { background: var(--s); color: white; border: 4px solid white; padding: 25px 50px; font-size: 1.5rem; font-weight: bold; border-radius: 15px; cursor: pointer; display: block; margin: 20px auto; }
</style>
</head>
<body>
    <div id="welcome-screen">
        <div class="welcome-content" role="main">
            <h1 style="font-size:2.5rem; margin-bottom:10px;">Music Braille Teacher</h1>
            <p style="font-size:1.2rem; margin-bottom:30px;">Benvenuto. Premi il tasto sotto per iniziare.</p>
            
            <button 
                id="start-trigger" 
                class="btn-accessibile"
                type="button"
                onclick="startApp();"
                aria-label="Entra nell'aula.">
                ENTRA NELL'AULA
            </button>
        </div>
    </div>

    <div class="container" id="main-app" aria-hidden="true">
        <nav class="tabs" role="tablist">
            <button class="tab-btn active" role="tab" onclick="openTab('comp')">üéº COMPOSITORE</button>
            <button class="tab-btn" role="tab" onclick="openTab('quiz')">‚úçÔ∏è QUIZ STUDENTE</button>
            <button class="tab-btn" role="tab" onclick="openTab('docente')">üìö PRONTUARIO</button>
            <button class="tab-btn" role="tab" onclick="openTab('risorse')">üìñ RISORSE PDF</button>
        </nav>
        
        <section id="comp" class="content-panel active" role="tabpanel">
            <div class="staff-container"><canvas id="cvsComp" width="800" height="160" aria-label="Pentagramma"></canvas></div>
            <div id="prev-char" class="char-preview" aria-live="polite">‚†Ä</div>
            <div class="braille-grid" role="group" aria-label="Cella Braille">
                <div class="dot" id="c-dot-1"></div><div class="dot" id="c-dot-4"></div>
                <div class="dot" id="c-dot-2"></div><div class="dot" id="c-dot-5"></div>
                <div class="dot" id="c-dot-3"></div><div class="dot" id="c-dot-6"></div>
            </div>
            <div id="battuta-visual" style="text-align:center;font-size:2rem;color:var(--s);letter-spacing:10px" aria-live="assertive"></div>
        </section>

        <section id="quiz" class="content-panel" role="tabpanel">
            <h2 id="q-text" style="text-align:center">Caricamento...</h2>
            <div class="staff-container"><canvas id="cvsQuiz" width="400" height="160" style="margin:auto;display:block"></canvas></div>
            <div class="braille-grid">
                <div class="dot" id="q-dot-1"></div><div class="dot" id="q-dot-4"></div>
                <div class="dot" id="q-dot-2"></div><div class="dot" id="q-dot-5"></div>
                <div class="dot" id="q-dot-3"></div><div class="dot" id="q-dot-6"></div>
            </div>
            <div style="text-align:center"><button class="tab-btn active" onclick="checkQuiz()">VERIFICA</button></div>
        </section>

        <section id="docente" class="content-panel" role="tabpanel"><div id="table-box"></div></section>
        
        <section id="risorse" class="content-panel" role="tabpanel">
            <h2 style="text-align:center">Manuale PDF</h2>
            <iframe src="guida-musica-braille.pdf" class="pdf-viewer" title="Manuale PDF"></iframe>
        </section>
    </div>

<script>
// Logica offuscata e corretta
const _0x1f2e=['DO','RE','MI','FA','SOL','LA','SI','fromCharCode','currentTime','exponentialRampToValueAtTime','triangle','destination','createGain','createOscillator','setValueAtTime','start','stop','pos','sym','char','map','join','find','sort','filter','includes','Space','preventDefault','active','cvsComp','cvsQuiz','table-box','SpeechSynthesisUtterance','lang','speak','cancel','innerHTML'];(function(_0x32e5d7,_0x1f2e2e){const _0x4d164c=function(_0x2e8f05){while(--_0x2e8f05){_0x32e5d7['push'](_0x32e5d7['shift']());}};_0x4d164c(++_0x1f2e2e);}(_0x1f2e,0x1a4));const _0x4d16=function(_0x32e5d7,_0x1f2e2e){_0x32e5d7=_0x32e5d7-0x0;let _0x4d164c=_0x1f2e[_0x32e5d7];return _0x4d164c;};const database=[{n:_0x4d16('0x0'),p:[1,4,5],f:261.63,pos:5},{n:_0x4d16('0x1'),p:[1,5],f:293.66,pos:4},{n:_0x4d16('0x2'),p:[1,2,4],f:329.63,pos:3},{n:_0x4d16('0x3'),p:[1,2,4,5],f:349.23,pos:2},{n:_0x4d16('0x4'),p:[1,2,5],f:392,pos:1},{n:_0x4d16('0x5'),p:[2,4],f:440,pos:0},{n:_0x4d16('0x6'),p:[2,4,5],f:493.88,pos:-1}];const dMap={'':{m:4,s:'\ud834\udd1d',t:'Semibreve'},'3':{m:2,s:'\ud834\udd1e',t:'Minima'},'6':{m:1,s:'\ud834\udd1f',t:'Semiminima'},'3,6':{m:0.5,s:'\ud834\udd20',t:'Croma'}};let audioCtx,currentKeys=new Set(),score=[],activeQuiz=null;function initAudio(){if(!audioCtx)audioCtx=new(window.AudioContext||window.webkitAudioContext)()}function startApp(){initAudio();document.getElementById('welcome-screen').style.display='none';const m=document.getElementById('main-app');m.style.display='block';m.setAttribute('aria-hidden','false');drawStaff(_0x4d16('0x1d'),[]);buildTable();parla('Aula aperta. Benvenuto.')}function playNote(f,m){if(!f||!audioCtx)return;const g=audioCtx[_0x4d16('0xc')]();g.connect(audioCtx[_0x4d16('0xb')]);const o=audioCtx[_0x4d16('0xd')]();o.type=_0x4d16('0xa');o.frequency[_0x4d16('0xe')](f,audioCtx[_0x4d16('0x8')]);g.gain[_0x4d16('0xe')](.5,audioCtx[_0x4d16('0x8')]);g.gain[_0x4d16('0x9')](.01,audioCtx[_0x4d16('0x8')]+m/1e3);o.connect(g);o[_0x4d16('0xf')]();o[_0x4d16('0x10')](audioCtx[_0x4d16('0x8')]+m/1e3)}function getBChar(s){let v=0;const b={1:1,2:2,3:4,4:8,5:16,6:32};s.forEach(p=>v+=b[p]);return String[_0x4d16('0x7')](10240+v)}function drawStaff(i,n){const c=document.getElementById(i);if(!c)return;const t=c.getContext('2d');t.clearRect(0,0,c.width,c.height);t.strokeStyle='#ddd';for(let j=0;j<5;j++){let y=60+j*10;t.beginPath();t.moveTo(30,y);t.lineTo(c.width-30,y);t.stroke()}t.font='45px serif';t.fillStyle='#333';t.fillText('\ud834\udd1e',40,95);let x=110;n.forEach(e=>{let y=95+e[_0x4d16('0x11')]*5;t.fillText(e[_0x4d16('0x12')]||'\ud834\udd1f',x,y);if(e[_0x4d16('0x11')]>=5){t.beginPath();t.moveTo(x-5,105);t.lineTo(x+25,105);t.stroke()}x+=60})}const kMap={f:1,d:2,s:3,j:4,k:5,l:6};window.addEventListener('keydown',e=>{const k=e.key.toLowerCase(),p=document.querySelector('.content-panel.active').id;if(kMap[k]){currentKeys.add(kMap[k]);const i=p==='comp'?'c-':'q-';document.getElementById(i+'dot-'+kMap[k])?.classList.add(_0x4d16('0x1c'));}if(e.code===_0x4d16('0x1a')){e[_0x4d16('0x1b')]();if(p==='comp'){const s=Array.from(currentKeys)[_0x4d16('0x17')](),b=s[_0x4d16('0x18')](x=>[1,2,4,5][_0x4d16('0x19')](x))[_0x4d16('0x15')](','),m=s[_0x4d16('0x18')](x=>[3,6][_0x4d16('0x19')](x))[_0x4d16('0x15')]((','),d=database[_0x4d16('0x16')](x=>x.p[_0x4d16('0x15')](',')===b);if(d&&dMap[m]){const o={pos:d[_0x4d16('0x11')],sym:dMap[m][_0x4d16('0x12')],f:d.f,ms:dMap[m].m*500,char:getBChar(currentKeys)};score.push(o);drawStaff(_0x4d16('0x1d'),score);playNote(o.f,o.ms);document.getElementById('battuta-visual').innerText=score[_0x4d16('0x14')](x=>x[_0x4d16('0x13')])[_0x4d16('0x15')]('')}}resetDots()}});function resetDots(){currentKeys.clear();document.querySelectorAll('.dot').forEach(d=>d.classList.remove(_0x4d16('0x1c')));const p=document.getElementById('prev-char');if(p)p.innerText='‚†Ä'}function openTab(i){document.querySelectorAll('.content-panel, .tab-btn').forEach(x=>x.classList.remove(_0x4d16('0x1c')));document.getElementById(i).classList.add(_0x4d16('0x1c'));event.currentTarget.classList.add(_0x4d16('0x1c'));i==='quiz'&&startQuiz()}function startQuiz(){const n=database[Math.floor(Math.random()*database.length)],k=Object.keys(dMap)[Math.floor(Math.random()*4)];activeQuiz={p:[...n.p,...(k?k.split(','):[])][_0x4d16('0x17')]()['map'](Number)[_0x4d16('0x15')](','),label:n.n+' '+dMap[k].t};document.getElementById('q-text').innerText='Scrivi: '+activeQuiz.label;drawStaff(_0x4d16('0x1e'),[{pos:n.pos,sym:dMap[k].s}])}function checkQuiz(){if(Array.from(currentKeys)[_0x4d16('0x17')]()['join'](',')===activeQuiz.p){parla('Ottimo!');setTimeout(startQuiz,1e3)}else parla('Riprova');resetDots()}function parla(t){window.speechSynthesis[_0x4d16('0x23')]();const m=new SpeechSynthesisUtterance(t);m[_0x4d16('0x21')]='it-IT';window.speechSynthesis[_0x4d16('0x22')](m)}function buildTable(){let h='<table style="width:100%;border-collapse:collapse;text-align:center"><tr style="background:#eee"><th>Nota</th><th>Semibreve</th><th>Minima</th><th>Semiminima</th><th>Croma</th></tr>';database.forEach(n=>{h+='<tr><td style="padding:10px;border:1px solid #ddd"><b>'+n.n+'</b></td><td style="font-size:2rem;border:1px solid #ddd">'+getBChar(new Set(n.p))+'</td><td style="font-size:2rem;border:1px solid #ddd">'+getBChar(new Set([...n.p,3]))+'</td><td style="font-size:2rem;border:1px solid #ddd">'+getBChar(new Set([...n.p,6]))+'</td><td style="font-size:2rem;border:1px solid #ddd">'+getBChar(new Set([...n.p,3,6]))+'</td></tr>'});document.getElementById(_0x4d16('0x1f'))[_0x4d16('0x24')]=h+'</table>'}
</script>
</body>
</html>
